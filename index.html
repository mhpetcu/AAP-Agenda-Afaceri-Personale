<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AAP - Agenda Afacerilor Personale</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg: #f9f9f9;
    --text: #1a1a1a;
    --card: #ffffff;
    --accent: #f9f9f9;
    --red: #dc3545;
  }
  body.dark {
    --bg: #121212;
    --text: #e0e0e0;
    --card: #1e1e1e;
    --accent: #0e0e0e;
    --red: #ff6b6b;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Roboto', 'Montserrat', sans-serif;
    margin: 0;
    padding: 1rem;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    max-width: 700px;
    margin: auto;
  }
  h1 {
    text-align: center;
    font-size: 3.2rem;
    margin-bottom: 0.3rem;
    font-family: 'Montserrat', sans-serif;
  }
  .submotto {
    text-align: center;
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 1rem;
    font-family: 'Roboto', sans-serif;
  }
  .toggle-dark {
    float: right;
    margin-bottom: 1rem;
    cursor: pointer;
    background: none;
    color: var(--accent);
    border: none;
    padding: 0.4rem 0.8rem;
    font-size: 1.4rem;
    user-select: none;
  }
  .switch-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .switch-container button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: var(--card);
    color: var(--text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: background-color 0.2s, color 0.2s;
  }
  .switch-container button.active {
    background: var(--accent);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .sort-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .sort-container label {
    align-self: center;
    font-family: 'Montserrat', sans-serif;
  }
  .sort-container select {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
  }
  form {
    background: var(--card);
    padding: 1rem 1.2rem 1.4rem;
    border-radius: 12px;
    display: grid;
    gap: 0.8rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
    margin-bottom: 1rem;
  }
  input, select, button, textarea {
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: var(--card);
    color: var(--text);
    transition: all 0.2s;
    font-family: 'Roboto', sans-serif;
  }
  button {
    background: var(--accent);
    color: var(--text);
    border: none;
    cursor: pointer;
    font-weight: 600;
    font-family: 'Montserrat', sans-serif;
  }
  body.dark input,
  body.dark select,
  body.dark textarea {
    background: #2a2a2a;
    color: #e0e0e0;
    border: 1px solid #555;
  }
  .calendar-time-container {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .calendar-time-container input[type="date"],
  .calendar-time-container input[type="time"] {
    flex: 1;
    min-width: 120px;
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 0;
  }
  .task {
    background: var(--card);
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .task-info {
    flex: 1 1 65%;
    min-width: 250px;
  }
  .task-actions {
    flex: 1 1 30%;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .task p {
    margin: 0.2rem 0;
  }
  .badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
    border-radius: 5px;
    color: white;
    margin-right: 0.5rem;
    font-weight: 600;
    user-select: none;
  }
  .urgent { background: #dc3545; }
  .normal { background: #28a745; }
  .status-in { background: #ffc107; color: black; }
  .status-out { background: #17a2b8; }
  .overdue {
    color: var(--red);
    font-weight: 700;
  }
  .tag-badge {
    font-weight: 700;
    cursor: pointer;
    user-select: none;
  }
  @media (max-width: 700px) {
    .task {
      flex-direction: column;
    }
    .task-actions {
      justify-content: flex-start;
    }
    .calendar-time-container {
      flex-direction: column;
    }
  }
  .floater {
    position: relative;
    margin-bottom: 80px;
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.85rem;
    font-family: 'Roboto', sans-serif;
    color: var(--text);
    user-select: none;
    opacity: 0.7;
  }
</style>
</head>
<body>
<div class="container" role="main">
  <button class="toggle-dark" id="darkToggle" aria-label="Toggle dark mode">ðŸŒ“</button>
  <h1>AAP</h1>
  <p class="submotto">Agenda Afacerilor Personale</p>

  <nav class="switch-container" role="tablist" aria-label="SelecteazÄƒ lista afacerilor">
    <button id="btnPersonal" class="active" role="tab" aria-selected="true" aria-controls="listPersonal" tabindex="0">Afaceri Interne</button>
    <button id="btnExternal" role="tab" aria-selected="false" aria-controls="listExternal" tabindex="-1">Afaceri Externe</button>
    <button id="btnOperational" role="tab" aria-selected="false" aria-controls="listOperational" tabindex="-1">Afaceri OperaÈ›ionale</button>
  </nav>

  <div class="sort-container">
    <label for="sortSelect">Sortare:</label>
    <select id="sortSelect" aria-label="SelecteazÄƒ criteriul de sortare">
      <option value="added">Data adÄƒugÄƒrii</option>
      <option value="deadline">Deadline</option>
      <option value="priority">Prioritate</option>
    </select>
  </div>

  <form id="taskForm" autocomplete="off" aria-label="Formular adÄƒugare/modificare task">
    <input type="text" id="title" placeholder="Ce ai de fÄƒcut?" required aria-required="true" aria-label="Titlu task" />
    <textarea id="details" rows="2" placeholder="Detalii (opÈ›ional)" aria-label="Detalii task"></textarea>
    <select id="priority" aria-label="SelecteazÄƒ prioritatea">
      <option value="normal">Prioritate: Normal</option>
      <option value="urgent">Prioritate: Urgent</option>
    </select>
    <select id="status" aria-label="SelecteazÄƒ statusul">
      <option value="in">Status: ÃŽn curs</option>
      <option value="out">Status: Gata</option>
    </select>
    <div class="calendar-time-container" aria-label="SelecteazÄƒ deadline-ul">
      <input type="date" id="deadline" aria-label="Data limitÄƒ" />
      <input type="time" id="deadlineTime" aria-label="Ora limitÄƒ" />
    </div>
    <div>
      <label for="tagInput" style="font-weight:600; margin-right:0.5rem;">Tag:</label>
      <input type="text" id="tagInput" placeholder="Nume tag" aria-label="Nume tag" style="width:120px;" />
      <input type="color" id="tagColor" value="#FF0000" aria-label="Culoare tag" style="width:60px; vertical-align:middle; margin-left:0.3rem;" />
      <button type="button" id="addTagBtn" aria-label="AdaugÄƒ tag" style="margin-left:0.5rem; padding:0.3rem 0.8rem; font-size:0.9rem;">AdaugÄƒ</button>
    </div>
    <div id="tagsContainer" aria-live="polite" style="margin-top:0.4rem;"></div>
    <button type="submit" style="margin-top:0.8rem;">SalveazÄƒ task</button>
  </form>

  <ul id="taskList" aria-live="polite" aria-label="Lista taskurilor"></ul>
</div>

<div class="floater">by @mhpetcu</div>

<script>
  // UTILITARE
  function formatDateDisplay(dateStr) {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
  }
  // Salvare / Ã®ncÄƒrcare liste Ã®n localStorage, cÃ¢te o listÄƒ pe categorie
  const STORAGE_KEYS = {
    personal: 'tasks_personal',
    external: 'tasks_external',
    operational: 'tasks_operational',
  };

  // Mod dark toggle
  const darkToggle = document.getElementById("darkToggle");
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  });
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  // Elemente UI
  const btnPersonal = document.getElementById('btnPersonal');
  const btnExternal = document.getElementById('btnExternal');
  const btnOperational = document.getElementById('btnOperational');
  const sortSelect = document.getElementById('sortSelect');
  const taskListElem = document.getElementById('taskList');
  const taskForm = document.getElementById('taskForm');
  const titleInput = document.getElementById('title');
  const detailsInput = document.getElementById('details');
  const prioritySelect = document.getElementById('priority');
  const statusSelect = document.getElementById('status');
  const deadlineInput = document.getElementById('deadline');
  const deadlineTimeInput = document.getElementById('deadlineTime');
  const tagInput = document.getElementById('tagInput');
  const tagColorInput = document.getElementById('tagColor');
  const addTagBtn = document.getElementById('addTagBtn');
  const tagsContainer = document.getElementById('tagsContainer');

  let currentList = 'personal';
  let tasks = [];
  let editIndex = null;
  let currentTags = []; // tag-urile unui task temporar

  // SchimbÄƒ tab lista activÄƒ
  function switchList(listName) {
    currentList = listName;
    btnPersonal.classList.toggle('active', listName === 'personal');
    btnPersonal.setAttribute('aria-selected', listName === 'personal');
    btnPersonal.tabIndex = listName === 'personal' ? 0 : -1;

    btnExternal.classList.toggle('active', listName === 'external');
    btnExternal.setAttribute('aria-selected', listName === 'external');
    btnExternal.tabIndex = listName === 'external' ? 0 : -1;

    btnOperational.classList.toggle('active', listName === 'operational');
    btnOperational.setAttribute('aria-selected', listName === 'operational');
    btnOperational.tabIndex = listName === 'operational' ? 0 : -1;

    tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS[listName])) || [];
    editIndex = null;
    clearForm();
    renderTasks();
  }

  btnPersonal.addEventListener('click', () => switchList('personal'));
  btnExternal.addEventListener('click', () => switchList('external'));
  btnOperational.addEventListener('click', () => switchList('operational'));

  // Sortare
  sortSelect.addEventListener('change', () => {
    renderTasks();
  });

  // Salvare in localStorage
  function saveTasks() {
    localStorage.setItem(STORAGE_KEYS[currentList], JSON.stringify(tasks));
  }

  // AdaugÄƒ un tag temporar Ã®n formular
  addTagBtn.addEventListener('click', () => {
    const tagName = tagInput.value.trim();
    const tagColor = tagColorInput.value;
    if (!tagName) {
      alert("Numele tag-ului nu poate fi gol.");
      return;
    }
    // DacÄƒ tag existÄƒ deja, nu-l adaugÄƒ
    if (currentTags.find(t => t.name.toLowerCase() === tagName.toLowerCase())) {
      alert("Tag-ul existÄƒ deja.");
      return;
    }
    currentTags.push({name: tagName, color: tagColor});
    tagInput.value = '';
    renderCurrentTags();
  });

  // AfiÈ™eazÄƒ tag-urile temporare din formular, cu opÈ›iune È™tergere È™i editare culoare
  function renderCurrentTags() {
    tagsContainer.innerHTML = '';
    currentTags.forEach((tag, idx) => {
      const span = document.createElement('span');
      span.className = 'tag-badge';
      span.style.backgroundColor = tag.color;
      span.textContent = tag.name;
      span.title = "Click pentru a schimba culoarea";
      span.style.marginRight = '0.4rem';
      span.style.padding = '0.2rem 0.5rem';
      span.style.borderRadius = '5px';
      span.style.userSelect = 'none';

      // Clic pe tag pentru editare culoare
      span.addEventListener('click', () => {
        const newColor = prompt("Introdu o culoare hex pentru tag-ul '"+tag.name+"':", tag.color);
        if(newColor && /^#([0-9A-F]{3}){1,2}$/i.test(newColor.trim())) {
          tag.color = newColor.trim();
          renderCurrentTags();
        } else if(newColor !== null) {
          alert('Codul de culoare nu este valid. Trebuie un hex precum #FF0000');
        }
      });

      // AdÄƒugÄƒm buton mic de È™tergere
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Ã—';
      delBtn.style.marginLeft = '0.3rem';
      delBtn.style.border = 'none';
      delBtn.style.background = 'transparent';
      delBtn.style.color = 'white';
      delBtn.style.fontWeight = '700';
      delBtn.style.cursor = 'pointer';
      delBtn.title = 'È˜terge tag';
      delBtn.style.userSelect = 'none';
      delBtn.style.padding = '0 0.1rem';

      delBtn.addEventListener('click', e => {
        e.stopPropagation();
        currentTags.splice(idx, 1);
        renderCurrentTags();
      });

      span.appendChild(delBtn);
      tagsContainer.appendChild(span);
    });
  }

  // Sortare funcÈ›ie
  function compareTasks(a, b) {
    const criteria = sortSelect.value;
    if (criteria === 'added') {
      return a._addedAt - b._addedAt;
    }
    if (criteria === 'deadline') {
      if (!a.deadline && b.deadline) return 1;
      if (a.deadline && !b.deadline) return -1;
      if (!a.deadline && !b.deadline) return 0;
      if (a.deadline < b.deadline) return -1;
      if (a.deadline > b.deadline) return 1;
      if (!a.deadlineTime && b.deadlineTime) return 1;
      if (a.deadlineTime && !b.deadlineTime) return -1;
      if (!a.deadlineTime && !b.deadlineTime) return 0;
      if (a.deadlineTime < b.deadlineTime) return -1;
      if (a.deadlineTime > b.deadlineTime) return 1;
      return 0;
    }
    if (criteria === 'priority') {
      if (a.priority === b.priority) return 0;
      if (a.priority === 'urgent') return -1;
      if (b.priority === 'urgent') return 1;
    }
    return 0;
  }

  // Render taskuri
  function renderTasks() {
    taskListElem.innerHTML = '';
    if (tasks.length === 0) {
      taskListElem.innerHTML = '<li>Lista este goalÄƒ.</li>';
      return;
    }
    tasks.sort(compareTasks);
    const nowDate = new Date();

    for (let i = 0; i < tasks.length; i++) {
      const t = tasks[i];
      const li = document.createElement('li');
      li.className = 'task';

      const taskInfo = document.createElement('div');
      taskInfo.className = 'task-info';

      const title = document.createElement('p');
      title.textContent = t.title;
      title.style.fontWeight = '600';

      const details = document.createElement('p');
      details.textContent = t.details || '';

      // Priority badge
      const priorityBadge = document.createElement('span');
      priorityBadge.className = 'badge ' + (t.priority === 'urgent' ? 'urgent' : 'normal');
      priorityBadge.textContent = t.priority === 'urgent' ? 'Urgent' : 'Normal';

      // Status badge
      const statusBadge = document.createElement('span');
      statusBadge.className = 'badge ' + (t.status === 'in' ? 'status-in' : 'status-out');
      statusBadge.textContent = t.status === 'in' ? 'ÃŽn curs' : 'Gata';

      // Deadline text
      let deadlineText = '';
      if (t.deadline) {
        deadlineText = formatDateDisplay(t.deadline);
        if (t.deadlineTime) deadlineText += ' ' + t.deadlineTime;
      }
      const deadlineP = document.createElement('p');
      deadlineP.textContent = deadlineText;
      if (t.deadline && t.status === 'in') {
        const dlDate = new Date(t.deadline + 'T' + (t.deadlineTime || '00:00'));
        if (dlDate < nowDate) {
          deadlineP.classList.add('overdue');
        }
      }

      // Tags display
      const tagsDiv = document.createElement('div');
      if (t.tags && t.tags.length) {
        t.tags.forEach(tag => {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'tag-badge';
          tagSpan.style.backgroundColor = tag.color;
          tagSpan.textContent = tag.name;
          tagsDiv.appendChild(tagSpan);
        });
      }

      taskInfo.appendChild(title);
      if(details.textContent) taskInfo.appendChild(details);
      taskInfo.appendChild(priorityBadge);
      taskInfo.appendChild(statusBadge);
      if(deadlineText) taskInfo.appendChild(deadlineP);
      if(tagsDiv.childNodes.length) taskInfo.appendChild(tagsDiv);

      // Butoane editeazÄƒ/È™terge
      const taskActions = document.createElement('div');
      taskActions.className = 'task-actions';

      const editBtn = document.createElement('button');
      editBtn.textContent = 'EditeazÄƒ';
      editBtn.type = 'button';
      editBtn.onclick = () => {
        editIndex = i;
        fillFormWithTask(t);
        taskForm.querySelector('button[type=submit]').textContent = 'ModificÄƒ task';
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'È˜terge';
      deleteBtn.type = 'button';
      deleteBtn.onclick = () => {
        if(confirm('È˜tergi acest task?')) {
          tasks.splice(i,1);
          saveTasks();
          renderTasks();
          clearForm();
        }
      };

      taskActions.appendChild(editBtn);
      taskActions.appendChild(deleteBtn);

      li.appendChild(taskInfo);
      li.appendChild(taskActions);
      taskListElem.appendChild(li);
    }
  }

  // CompleteazÄƒ formularul cÃ¢nd editezi task
  function fillFormWithTask(task) {
    titleInput.value = task.title;
    detailsInput.value = task.details || '';
    prioritySelect.value = task.priority;
    statusSelect.value = task.status;
    deadlineInput.value = task.deadline || '';
    deadlineTimeInput.value = task.deadlineTime || '';
    currentTags = task.tags ? JSON.parse(JSON.stringify(task.tags)) : [];
    renderCurrentTags();
  }

  // CurÄƒÈ›Äƒ formularul
  function clearForm() {
    taskForm.reset();
    deadlineInput.value = '';
    deadlineTimeInput.value = '';
    currentTags = [];
    renderCurrentTags();
    editIndex = null;
    taskForm.querySelector('button[type=submit]').textContent = 'SalveazÄƒ task';
  }

  // TrateazÄƒ submit formular
  taskForm.addEventListener('submit', e => {
    e.preventDefault();

    const newTask = {
      title: titleInput.value.trim(),
      details: detailsInput.value.trim(),
      priority: prioritySelect.value,
      status: statusSelect.value,
      deadline: deadlineInput.value,
      deadlineTime: deadlineTimeInput.value,
      tags: JSON.parse(JSON.stringify(currentTags)),
      _addedAt: editIndex === null ? Date.now() : tasks[editIndex]._addedAt,
    };
    if (!newTask.title) {
      alert('Titlul este obligatoriu!');
      return;
    }
    if (editIndex === null) {
      tasks.push(newTask);
    } else {
      tasks[editIndex] = newTask;
    }
    saveTasks();
    renderTasks();
    clearForm();
  });

  // Init
  switchList('personal');
</script>
</body>
</html>
