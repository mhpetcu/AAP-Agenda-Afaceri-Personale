<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AAP V3 - Agenda Afacerilor Personale</title>
<style>
  :root {
    --bg: #f9f9f9;
    --text: #1a1a1a;
    --card: #ffffff;
    --accent: #f9f9f9;
    --red: #dc3545;
  }
  body.dark {
    --bg: #121212;
    --text: #e0e0e0;
    --card: #1e1e1e;
    --accent: #0e0e0e;
    --red: #ff6b6b;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Roboto', 'Montserrat', sans-serif;
    margin: 0;
    padding: 1rem;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    max-width: 700px;
    margin: auto;
  }
  h1 {
    text-align: center;
    font-size: 3.2rem;
    margin-bottom: 0.3rem;
    font-family: 'Montserrat', sans-serif;
  }
  .submotto {
    text-align: center;
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 1rem;
    font-family: 'Roboto', sans-serif;
  }
  .toggle-dark {
    float: right;
    margin-bottom: 1rem;
    cursor: pointer;
    background: none;
    color: var(--accent);
    border: none;
    padding: 0.4rem 0.8rem;
    font-size: 1.2rem;
  }
  form {
    background: var(--card);
    padding: 1.2rem;
    border-radius: 12px;
    display: grid;
    gap: 0.8rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
  }
  input, select, button, textarea {
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: var(--card);
    color: var(--text);
    transition: all 0.2s;
    font-family: 'Roboto', sans-serif;
  }
  button {
    background: var(--accent);
    color: var(--text);
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Montserrat', sans-serif;
  }
  body.dark input,
  body.dark select,
  body.dark textarea {
    background: #2a2a2a;
    color: #e0e0e0;
    border: 1px solid #555;
  }
  .calendar-time-container {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .calendar-time-container input[type="text"] {
    flex: 2;
  }
  .calendar-time-container input[type="time"] {
    flex: 1;
  }
  .calendar {
    position: absolute;
    background: var(--card);
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 300px;
    z-index: 1000;
    display: none;
  }
  .calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }
  .calendar-header button {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--accent);
    cursor: pointer;
  }
  .calendar-title {
    flex: 1;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 500;
    font-family: 'Montserrat', sans-serif;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-top: 0.5rem;
  }
  .calendar-day, .calendar-date {
    text-align: center;
    padding: 0.4rem 0;
    border-radius: 6px;
  }
  .calendar-date {
    cursor: pointer;
  }
  .calendar-date:hover,
  .calendar-date.selected {
    background: var(--accent);
    color: white;
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 1.5rem;
  }
  .task {
    background: var(--card);
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .task-info {
    flex: 1 1 60%;
  }
  .task-info p {
    margin: 0.15rem 0;
  }
  .task-tag {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    border-radius: 5px;
    font-weight: 600;
    margin: 0.3rem 0;
    user-select: none;
    cursor: pointer;
    color: white;
  }
  .task-actions {
    flex: 1 1 35%;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .task-actions button {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
  }
  .task-actions button svg {
    width: 18px;
    height: 18px;
    fill: var(--text);
  }
  .badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
    border-radius: 5px;
    color: white;
    margin-right: 0.5rem;
  }
  .urgent { background: #dc3545; }
  .normal { background: #28a745; }
  .status-in { background: #ffc107; color: black; }
  .status-out { background: #17a2b8; }
  .overdue {
    color: var(--red);
    font-weight: 600;
  }
  @media (max-width: 600px) {
    .task {
      flex-direction: column;
    }
    .task-actions {
      justify-content: flex-start;
    }
    .calendar-time-container {
      flex-direction: column;
    }
    .calendar-time-container input[type="text"], 
    .calendar-time-container input[type="time"] {
      flex: unset;
      width: 100%;
    }
    .toggle-dark {
      float: none;
      display: block;
      margin: 0 auto 1rem auto;
    }
  }
  .floater {
    position: relative;
    margin-bottom: 80px;
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.85rem;
    font-family: 'Roboto', sans-serif;
    color: var(--text);
    user-select: none;
    opacity: 0.7;
  }
  .submitsave {
    color: var(--text);
  }
  .switch-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .switch-container button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    padding: 0.4rem 1rem;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: var(--card);
    color: var(--text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: background-color 0.2s, color 0.2s;
  }
  .switch-container button.active {
    background: var(--accent);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .sort-container {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .sort-container select {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
  }
</style>
<title>AAP V3</title>
</head>
<body>
<div class="container">
  <button class="toggle-dark" id="darkToggle" aria-label="Toggle dark mode">ðŸŒ“</button>
  <h1>AAP</h1>
  <p class="submotto">Agenda Afacerilor Personale</p>

  <div class="switch-container" role="radiogroup" aria-label="Alege lista">
    <button id="personalListBtn" class="active" aria-pressed="true" type="button">Afaceri Interne</button>
    <button id="workListBtn" aria-pressed="false" type="button">Afaceri Externe</button>
    <button id="operationalListBtn" aria-pressed="false" type="button">Afaceri OperaÈ›ionale</button>
  </div>

  <div class="sort-container">
    <label for="sortSelect">Sortare:</label>
    <select id="sortSelect" aria-label="SelecteazÄƒ criteriul de sortare">
      <option value="added">Data adÄƒugÄƒrii</option>
      <option value="deadline">Deadline</option>
      <option value="priority">Prioritate</option>
    </select>
  </div>

  <form id="taskForm" autocomplete="off">
    <input type="text" id="title" placeholder="Ce ai de fÄƒcut?" required aria-required="true" />
    <textarea id="details" rows="2" placeholder="Detalii (opÈ›ional)"></textarea>
    <select id="priority" aria-label="Prioritate task">
      <option value="normal">Prioritate: Normal</option>
      <option value="urgent">Prioritate: Urgent</option>
    </select>
    <select id="status" aria-label="Status task">
      <option value="in">Status: ÃŽn curs</option>
      <option value="out">Status: Gata</option>
    </select>
    <div class="calendar-time-container">
      <input type="text" id="deadline" placeholder="Deadline (dd/mm/yyyy)" readonly aria-label="Deadline" />
      <input type="time" id="deadlineTime" aria-label="Ora deadline" />
    </div>

    <label for="tagInput" style="margin-top:10px;">Tag (apasÄƒ pe culoare pentru a schimba):</label>
    <input type="text" id="tagInput" placeholder="EtichetÄƒ task" required style="width: 60%; display: inline-block; margin-right: 10px;" aria-label="Tag task" />
    <input type="color" id="tagColor" value="#4a90e2" style="width: 30%; display: inline-block; vertical-align: middle;" aria-label="Culoare tag" />

    <button type="submit" class="submitsave">SalveazÄƒ task</button>
  </form>

  <ul id="taskList" aria-live="polite" aria-label="Lista taskurilor"></ul>
</div>

<div class="floater">by @mhpetcu</div>

<script>
  // Formatare data yyyy-mm-dd <-> dd/mm/yyyy
  const formatDateDisplay = (dateStr) => {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
  };

  const parseDateInput = (displayStr) => {
    if (!displayStr) return '';
    const parts = displayStr.split('/');
    if(parts.length !== 3) return '';
    const [day, month, year] = parts;
    return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
  };

  // Toggle dark mode
  const darkToggle = document.getElementById("darkToggle");
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  });
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  // Calendar simplu
  const deadlineInput = document.getElementById("deadline");
  const deadlineTimeInput = document.getElementById("deadlineTime");

  // AdÄƒugare calendar minimalist (pop-up) la input deadline
  deadlineInput.addEventListener("focus", () => {
    const date = prompt("Introdu data deadline-ului (format dd/mm/yyyy):", deadlineInput.value || "");
    if(date) {
      // Validare scurta
      if (/^\d{2}\/\d{2}\/\d{4}$/.test(date)) {
        deadlineInput.value = date;
      } else {
        alert("Formatul corect este dd/mm/yyyy.");
      }
    }
  });

  // Taskuri È™i liste
  let tasks = JSON.parse(localStorage.getItem("tasksV3")) || [];

  // Liste: "personal", "work", "operational"
  let currentList = "personal";

  const taskListEl = document.getElementById("taskList");
  const taskForm = document.getElementById("taskForm");
  const titleInput = document.getElementById("title");
  const detailsInput = document.getElementById("details");
  const prioritySelect = document.getElementById("priority");
  const statusSelect = document.getElementById("status");
  const tagInput = document.getElementById("tagInput");
  const tagColorInput = document.getElementById("tagColor");

  // Butoane schimbare liste
  const personalListBtn = document.getElementById("personalListBtn");
  const workListBtn = document.getElementById("workListBtn");
  const operationalListBtn = document.getElementById("operationalListBtn");

  personalListBtn.addEventListener("click", () => switchList("personal"));
  workListBtn.addEventListener("click", () => switchList("work"));
  operationalListBtn.addEventListener("click", () => switchList("operational"));

  // Sortare
  const sortSelect = document.getElementById("sortSelect");

  sortSelect.addEventListener("change", renderTasks);

  // SchimbÄƒ lista curentÄƒ È™i actualizeazÄƒ aria-pressed
  function switchList(listName) {
    currentList = listName;
    personalListBtn.classList.toggle("active", listName === "personal");
    personalListBtn.setAttribute("aria-pressed", listName === "personal");
    workListBtn.classList.toggle("active", listName === "work");
    workListBtn.setAttribute("aria-pressed", listName === "work");
    operationalListBtn.classList.toggle("active", listName === "operational");
    operationalListBtn.setAttribute("aria-pressed", listName === "operational");
    renderTasks();
  }

  // SalveazÄƒ Ã®n localStorage
  function saveTasks() {
    localStorage.setItem("tasksV3", JSON.stringify(tasks));
  }

  // RenderizeazÄƒ lista taskurilor filtrate pe lista curentÄƒ È™i sortate
  function renderTasks() {
    taskListEl.innerHTML = "";
    // Filtrare pe lista
    let filteredTasks = tasks.filter(t => t.list === currentList);

    // Sortare dupÄƒ selectat
    const sortBy = sortSelect.value;
    if (sortBy === "deadline") {
      filteredTasks.sort((a, b) => (a.deadline || '') > (b.deadline || '') ? 1 : -1);
    } else if (sortBy === "priority") {
      filteredTasks.sort((a, b) => {
        const p = { urgent: 0, normal: 1 };
        return p[a.priority] - p[b.priority];
      });
    } else {
      // added date (implicit ordinea din array)
    }

    if(filteredTasks.length === 0){
      taskListEl.innerHTML = "<p style='text-align:center; color:#888;'>Nicio afacere Ã®n aceastÄƒ listÄƒ.</p>";
      return;
    }

    filteredTasks.forEach((task, index) => {
      const li = document.createElement("li");
      li.className = "task";

      const info = document.createElement("div");
      info.className = "task-info";

      // Titlu
      const titluP = document.createElement("p");
      titluP.textContent = task.title;
      titluP.style.fontWeight = "700";
      info.appendChild(titluP);

      // Detalii
      if(task.details){
        const detaliiP = document.createElement("p");
        detaliiP.textContent = task.details;
        detaliiP.style.color = "var(--text)";
        detaliiP.style.fontSize = "0.9rem";
        info.appendChild(detaliiP);
      }

      // Deadline
      if(task.deadline){
        const dlP = document.createElement("p");
        dlP.textContent = "Deadline: " + formatDateDisplay(task.deadline) + (task.deadlineTime ? " " + task.deadlineTime : "");
        dlP.style.fontSize = "0.85rem";
        dlP.style.color = task.deadline && new Date(task.deadline) < new Date() ? "var(--red)" : "";
        info.appendChild(dlP);
      }

      // Tag - etichetÄƒ coloratÄƒ, click pentru editare culoare & nume
      const tagSpan = document.createElement("span");
      tagSpan.className = "task-tag";
      tagSpan.textContent = task.tag.name || "fÄƒrÄƒ tag";
      tagSpan.style.backgroundColor = task.tag.color || "#4a90e2";
      tagSpan.title = "Click pentru a edita tag-ul";
      tagSpan.setAttribute("tabindex", "0");
      tagSpan.addEventListener("click", () => editTag(task, index));
      tagSpan.addEventListener("keydown", (ev) => {
        if(ev.key === "Enter" || ev.key === " ") {
          ev.preventDefault();
          editTag(task, index);
        }
      });

      info.appendChild(tagSpan);

      // Prioritate
      const priorP = document.createElement("p");
      priorP.textContent = "Prioritate: " + task.priority;
      priorP.style.fontSize = "0.85rem";
      priorP.style.marginTop = "0.3rem";
      info.appendChild(priorP);

      // Status
      const statP = document.createElement("p");
      statP.textContent = "Status: " + (task.status === "in" ? "ÃŽn curs" : "Gata");
      statP.style.fontSize = "0.85rem";
      info.appendChild(statP);

      li.appendChild(info);

      // Butoane
      const btns = document.createElement("div");
      btns.className = "task-actions";

      // Icone inline SVG pentru butoane
      const editIcon = `<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 000-1.42l-2.34-2.34a1.003 1.003 0 00-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>`;
      const deleteIcon = `<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-4.5l-1-1z"/></svg>`;

      const editBtn = document.createElement("button");
      editBtn.type = "button";
      editBtn.innerHTML = editIcon + " EditeazÄƒ";
      editBtn.title = "EditeazÄƒ task";
      editBtn.onclick = () => editTask(index);

      const delBtn = document.createElement("button");
      delBtn.type = "button";
      delBtn.innerHTML = deleteIcon + " È˜terge";
      delBtn.title = "È˜terge task";
      delBtn.onclick = () => {
        if(confirm("Sigur doreÈ™ti sÄƒ È™tergi acest task?")){
          tasks.splice(index, 1);
          saveTasks();
          renderTasks();
        }
      };

      btns.appendChild(editBtn);
      btns.appendChild(delBtn);
      li.appendChild(btns);

      taskListEl.appendChild(li);
    });
  }

  // Editare tag (nume È™i culoare)
  function editTag(task, index) {
    const newName = prompt("EditeazÄƒ numele tag-ului:", task.tag.name);
    if(newName === null) return; // anulat
    const newColor = prompt("EditeazÄƒ culoarea tag-ului (hex, ex: #4a90e2):", task.tag.color);
    if(newColor === null) return;
    // Validare simplÄƒ culoare hex
    if(/^#[0-9A-Fa-f]{6}$/.test(newColor.trim())){
      task.tag.name = newName.trim() || "fÄƒrÄƒ tag";
      task.tag.color = newColor.trim();
      saveTasks();
      renderTasks();
    } else {
      alert("Culoare invalidÄƒ! FoloseÈ™te format hex, ex: #4a90e2");
    }
  }

  // Editare task (populeazÄƒ formularul cu datele)
  function editTask(index) {
    const t = tasks[index];
    titleInput.value = t.title;
    detailsInput.value = t.details;
    prioritySelect.value = t.priority;
    statusSelect.value = t.status;
    deadlineInput.value = t.deadline ? formatDateDisplay(t.deadline) : "";
    deadlineTimeInput.value = t.deadlineTime || "";
    tagInput.value = t.tag.name || "";
    tagColorInput.value = t.tag.color || "#4a90e2";

    // PasÄƒm index-ul Ã®n form pentru salvare (modificare)
    taskForm.dataset.editIndex = index;

    // ComutÄƒm la lista corectÄƒ
    if(t.list) {
      switchList(t.list);
    }
  }

  // Reset formular
  function resetForm() {
    taskForm.reset();
    delete taskForm.dataset.editIndex;
    tagColorInput.value = "#4a90e2";
  }

  taskForm.addEventListener("submit", e => {
    e.preventDefault();

    // VerificÄƒri simple
    if(!titleInput.value.trim()){
      alert("Titlul taskului este obligatoriu!");
      return;
    }
    if(!tagInput.value.trim()){
      alert("Tag-ul este obligatoriu!");
      return;
    }

    // Construim task-ul
    const taskData = {
      title: titleInput.value.trim(),
      details: detailsInput.value.trim(),
      priority: prioritySelect.value,
      status: statusSelect.value,
      deadline: deadlineInput.value ? parseDateInput(deadlineInput.value) : "",
      deadlineTime: deadlineTimeInput.value || "",
      tag: {
        name: tagInput.value.trim(),
        color: tagColorInput.value
      },
      list: currentList
    };

    // DacÄƒ editÄƒm un task existent
    if(taskForm.dataset.editIndex !== undefined){
      const idx = Number(taskForm.dataset.editIndex);
      tasks[idx] = taskData;
    } else {
      tasks.push(taskData);
    }

    saveTasks();
    renderTasks();
    resetForm();
  });

  // IniÈ›ializare
  switchList("personal");
</script>

</body>
</html>
