<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AAP - Agenda Afacerilor Personale</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg: #f9f9f9;
    --text: #1a1a1a;
    --card: #ffffff;
    --accent: #f9f9f9;
    --red: #dc3545;
  }
  body.dark {
    --bg: #121212;
    --text: #e0e0e0;
    --card: #1e1e1e;
    --accent: #0e0e0e;
    --red: #ff6b6b;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Roboto', 'Montserrat', sans-serif;
    margin: 0;
    padding: 1rem;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    max-width: 600px;
    margin: auto;
  }
  h1 {
    text-align: center;
    font-size: 3.2rem;
    margin-bottom: 0.3rem;
    font-family: 'Montserrat', sans-serif;
  }
  .submotto {
    text-align: center;
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 1rem;
    font-family: 'Roboto', sans-serif;
  }
  .toggle-dark {
    float: right;
    margin-bottom: 1rem;
    cursor: pointer;
    background: none;
    color: var(--accent);
    border: none;
    padding: 0.4rem 0.8rem;
    font-size: 1.2rem;
  }
  form {
    background: var(--card);
    padding: 1.2rem;
    border-radius: 12px;
    display: grid;
    gap: 0.8rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
  }
  input, select, button, textarea {
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: var(--card);
    color: var(--text);
    transition: all 0.2s;
    font-family: 'Roboto', sans-serif;
  }
  button {
    background: var(--accent);
    color: var(--text);
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Montserrat', sans-serif;
  }
  body.dark input,
  body.dark select,
  body.dark textarea {
    background: #2a2a2a;
    color: #e0e0e0;
    border: 1px solid #555;
  }
  .calendar-time-container {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .calendar-time-container input[type="text"] {
    flex: 2;
  }
  .calendar-time-container input[type="time"] {
    flex: 1;
  }
  .calendar {
    position: absolute;
    background: var(--card);
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 300px;
    z-index: 1000;
    display: none;
  }
  .calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }
  .calendar-header button {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--accent);
    cursor: pointer;
  }
  .calendar-title {
    flex: 1;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 500;
    font-family: 'Montserrat', sans-serif;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    margin-top: 0.5rem;
  }
  .calendar-day, .calendar-date {
    text-align: center;
    padding: 0.4rem 0;
    border-radius: 6px;
  }
  .calendar-date {
    cursor: pointer;
  }
  .calendar-date:hover,
  .calendar-date.selected {
    background: var(--accent);
    color: white;
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 1.5rem;
  }
  .task {
    background: var(--card);
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .task-info {
    flex: 1 1 60%;
  }
  .task-actions {
    flex: 1 1 35%;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .task p {
    margin: 0.2rem 0;
  }
  .badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
    border-radius: 5px;
    color: white;
    margin-right: 0.5rem;
  }
  .urgent { background: #dc3545; }
  .normal { background: #28a745; }
  .status-in { background: #ffc107; color: black; }
  .status-out { background: #17a2b8; }
  .overdue {
    color: var(--red);
    font-weight: 600;
  }
  @media (max-width: 500px) {
    .task {
      flex-direction: column;
    }
    .task-actions {
      justify-content: flex-start;
    }
    .calendar-time-container {
      flex-direction: column;
    }
    .calendar-time-container input[type="text"], 
    .calendar-time-container input[type="time"] {
      flex: unset;
      width: 100%;
    }
    .toggle-dark {
      float: none;
      display: block;
      margin: 0 auto 1rem auto;
    }
  }
  .floater {
    position: relative;
    margin-bottom: 80px;
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.85rem;
    font-family: 'Roboto', sans-serif;
    color: var(--text);
    user-select: none;
    opacity: 0.7;
  }
  .submitsave {
    color: var(--text);
  }
  .switch-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .switch-container button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    padding: 0.4rem 1rem;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: var(--card);
    color: var(--text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: background-color 0.2s, color 0.2s;
  }
  .switch-container button.active {
    background: var(--accent);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .sort-container {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .sort-container select {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
  }
</style>
</head>
<body>
<div class="container">
  <button class="toggle-dark" id="darkToggle" aria-label="Toggle dark mode">ðŸŒ“</button>
  <h1>AAP</h1>
  <p class="submotto">Agenda Afacerilor Personale</p>

  <div class="switch-container" role="radiogroup" aria-label="Alege lista">
    <button id="personalListBtn" class="active" aria-pressed="true" type="button">Afaceri Interne</button>
    <button id="workListBtn" aria-pressed="false" type="button">Afaceri Externe</button>
  </div>

  <div class="sort-container">
    <label for="sortSelect">Sortare:</label>
    <select id="sortSelect" aria-label="SelecteazÄƒ criteriul de sortare">
      <option value="added">Data adÄƒugÄƒrii</option>
      <option value="deadline">Deadline</option>
      <option value="priority">Prioritate</option>
    </select>
  </div>

  <form id="taskForm" autocomplete="off">
    <input type="text" id="title" placeholder="Ce ai de fÄƒcut?" required aria-required="true" />
    <textarea id="details" rows="2" placeholder="Detalii (opÈ›ional)"></textarea>
    <select id="priority">
      <option value="normal">Prioritate: Normal</option>
      <option value="urgent">Prioritate: Urgent</option>
    </select>
    <select id="status">
      <option value="in">Status: ÃŽn curs</option>
      <option value="out">Status: Gata</option>
    </select>
    <div class="calendar-time-container">
      <input type="text" id="deadline" placeholder="Deadline (dd/mm/yyyy)" readonly aria-label="Deadline" />
      <input type="time" id="deadlineTime" aria-label="Ora deadline" />
    </div>
    <div class="calendar" id="calendar" role="dialog" aria-modal="true" aria-label="Calendar">
      <div class="calendar-header">
        <button id="prevMonth" type="button" aria-label="Luna anterioarÄƒ">â€¹</button>
        <div class="calendar-title" id="calendarTitle">Iunie 2025</div>
        <button id="nextMonth" type="button" aria-label="Luna urmÄƒtoare">â€º</button>
      </div>
      <div class="calendar-grid" id="calendarDays" role="grid"></div>
    </div>
    <button type="submit" class="submitsave">SalveazÄƒ task</button>
  </form>

  <ul id="taskList" aria-live="polite" aria-label="Lista taskurilor"></ul>
</div>

<div class="floater">by @mhpetcu</div>

<script>
  // FormateazÄƒ data din yyyy-mm-dd Ã®n dd/mm/yyyy
  const formatDateDisplay = (dateStr) => {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
  };

  // ParseazÄƒ data din dd/mm/yyyy Ã®n yyyy-mm-dd
  const parseDateInput = (displayStr) => {
    if (!displayStr) return '';
    const parts = displayStr.split('/');
    if(parts.length !== 3) return '';
    const [day, month, year] = parts;
    return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
  };

  // Dark mode toggle
  const darkToggle = document.getElementById("darkToggle");
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  });
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  // Calendar & Date selection
  (() => {
    const calendar = document.getElementById('calendar');
    const deadlineInput = document.getElementById('deadline');
    const calendarDays = document.getElementById('calendarDays');
    const calendarTitle = document.getElementById('calendarTitle');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');

    const days = ['Lu', 'Ma', 'Mi', 'Jo', 'Vi', 'SÃ¢', 'Du'];

    let currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth();
    let selectedDate = null;

    function buildCalendar(year, month) {
      calendarDays.innerHTML = '';
      calendarTitle.textContent = ['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie','Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'][month] + ' ' + year;

      days.forEach(day => {
        const d = document.createElement('div');
        d.className = 'calendar-day';
        d.textContent = day;
        calendarDays.appendChild(d);
      });

      const firstDay = new Date(year, month, 1);
      let startDay = firstDay.getDay() - 1;
      if (startDay < 0) startDay = 6;
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for(let i = 0; i < startDay; i++) {
        const emptyCell = document.createElement('div');
        calendarDays.appendChild(emptyCell);
      }

      for(let dayNum = 1; dayNum <= daysInMonth; dayNum++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-date';
        dayCell.textContent = dayNum;
        const dateStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(dayNum).padStart(2,'0')}`;

        if (selectedDate === dateStr) {
          dayCell.classList.add('selected');
        }

        dayCell.onclick = () => {
          selectedDate = dateStr;
          deadlineInput.value = formatDateDisplay(dateStr);
          calendar.style.display = 'none';
          buildCalendar(year, month);
        };

        calendarDays.appendChild(dayCell);
      }
    }

    prevMonthBtn.onclick = () => {
      if (currentMonth === 0) {
        currentYear--;
        currentMonth = 11;
      } else {
        currentMonth--;
      }
      buildCalendar(currentYear, currentMonth);
    };

    nextMonthBtn.onclick = () => {
      if (currentMonth === 11) {
        currentYear++;
        currentMonth = 0;
      } else {
        currentMonth++;
      }
      buildCalendar(currentYear, currentMonth);
    };

    deadlineInput.addEventListener('click', () => {
      if (calendar.style.display === 'block') {
        calendar.style.display = 'none';
      } else {
        calendar.style.top = (deadlineInput.offsetTop + deadlineInput.offsetHeight + 5) + 'px';
        calendar.style.left = deadlineInput.offsetLeft + 'px';
        calendar.style.display = 'block';
      }
    });

    document.addEventListener('click', e => {
      if (!calendar.contains(e.target) && e.target !== deadlineInput) {
        calendar.style.display = 'none';
      }
    });

    // DacÄƒ deadline input are valoare, seteazÄƒ selectedDate Ã®n calendar
    if (deadlineInput.value) {
      selectedDate = parseDateInput(deadlineInput.value);
    }

    buildCalendar(currentYear, currentMonth);
  })();

  // Gestionare task-uri multiple liste, sortare È™i render
  const personalListBtn = document.getElementById('personalListBtn');
  const workListBtn = document.getElementById('workListBtn');
  const sortSelect = document.getElementById('sortSelect');
  const taskListElem = document.getElementById('taskList');
  const taskForm = document.getElementById('taskForm');

  // StocÄƒm liste separate Ã®n localStorage
  const STORAGE_KEYS = {
    personal: 'tasks_personal',
    work: 'tasks_work',
  };

  let currentList = 'personal';
  let tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS[currentList])) || [];
  let editIndex = null;

  function saveTasks() {
    localStorage.setItem(STORAGE_KEYS[currentList], JSON.stringify(tasks));
  }

  // Functie comparare pentru sortare
  function compareTasks(a, b) {
    const criteria = sortSelect.value;
    if (criteria === 'added') {
      // ordonare dupa index (inserare)
      return a._addedAt - b._addedAt;
    }
    if (criteria === 'deadline') {
      // daca unul are deadline si altul nu, cel fara deadline vine dupa
      if (!a.deadline && b.deadline) return 1;
      if (a.deadline && !b.deadline) return -1;
      if (!a.deadline && !b.deadline) return 0;

      // comparÄƒ data deadline-ului (yyyy-mm-dd)
      if (a.deadline < b.deadline) return -1;
      if (a.deadline > b.deadline) return 1;

      // dacÄƒ deadline-uri egale, sortÄƒm dupÄƒ ora
      if (!a.deadlineTime && b.deadlineTime) return 1;
      if (a.deadlineTime && !b.deadlineTime) return -1;
      if (!a.deadlineTime && !b.deadlineTime) return 0;

      if (a.deadlineTime < b.deadlineTime) return -1;
      if (a.deadlineTime > b.deadlineTime) return 1;

      return 0;
    }
    if (criteria === 'priority') {
      // urgent vine Ã®nainte de normal
      if (a.priority === b.priority) return 0;
      if (a.priority === 'urgent') return -1;
      if (b.priority === 'urgent') return 1;
    }
    return 0;
  }

  function renderTasks() {
    taskListElem.innerHTML = '';
    tasks.sort(compareTasks);

    if(tasks.length === 0){
      taskListElem.innerHTML = '<li>Lista este goalÄƒ.</li>';
      return;
    }

    const nowDate = new Date();
    for (let i = 0; i < tasks.length; i++) {
      const t = tasks[i];
      const li = document.createElement('li');
      li.className = 'task';

      const taskInfo = document.createElement('div');
      taskInfo.className = 'task-info';

      const title = document.createElement('p');
      title.textContent = t.title;
      title.style.fontWeight = '600';

      const details = document.createElement('p');
      details.textContent = t.details || '';

      // Prioritate badge
      const priorityBadge = document.createElement('span');
      priorityBadge.className = 'badge ' + (t.priority === 'urgent' ? 'urgent' : 'normal');
      priorityBadge.textContent = t.priority === 'urgent' ? 'Urgent' : 'Normal';

      // Status badge
      const statusBadge = document.createElement('span');
      statusBadge.className = 'badge ' + (t.status === 'in' ? 'status-in' : 'status-out');
      statusBadge.textContent = t.status === 'in' ? 'ÃŽn curs' : 'Gata';

      // Deadline text
      let deadlineText = '';
      if (t.deadline) {
        deadlineText = formatDateDisplay(t.deadline);
        if (t.deadlineTime) deadlineText += ' ' + t.deadlineTime;
      }

      const deadlineP = document.createElement('p');
      deadlineP.textContent = deadlineText;
      // DacÄƒ deadline trecut, pune clasa overdue (doar dacÄƒ statusul e 'in')
      if(t.deadline && t.status === 'in') {
        const dlDate = new Date(t.deadline + 'T' + (t.deadlineTime || '00:00'));
        if(dlDate < nowDate) {
          deadlineP.classList.add('overdue');
        }
      }

      taskInfo.appendChild(title);
      if(details.textContent) taskInfo.appendChild(details);
      taskInfo.appendChild(priorityBadge);
      taskInfo.appendChild(statusBadge);
      if(deadlineText) taskInfo.appendChild(deadlineP);

      // AcÈ›iuni (edit, È™terge)
      const taskActions = document.createElement('div');
      taskActions.className = 'task-actions';

      const editBtn = document.createElement('button');
      editBtn.textContent = 'EditeazÄƒ';
      editBtn.type = 'button';
      editBtn.onclick = () => {
        editIndex = i;
        fillFormWithTask(t);
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'È˜terge';
      deleteBtn.type = 'button';
      deleteBtn.onclick = () => {
        if(confirm('È˜tergi acest task?')) {
          tasks.splice(i,1);
          saveTasks();
          renderTasks();
        }
      };

      taskActions.appendChild(editBtn);
      taskActions.appendChild(deleteBtn);

      li.appendChild(taskInfo);
      li.appendChild(taskActions);
      taskListElem.appendChild(li);
    }
  }

  function fillFormWithTask(task) {
    document.getElementById('title').value = task.title;
    document.getElementById('details').value = task.details || '';
    document.getElementById('priority').value = task.priority;
    document.getElementById('status').value = task.status;
    document.getElementById('deadline').value = formatDateDisplay(task.deadline || '');
    document.getElementById('deadlineTime').value = task.deadlineTime || '';
  }

  function clearForm() {
    taskForm.reset();
    document.getElementById('deadline').value = '';
    editIndex = null;
  }

  taskForm.addEventListener('submit', e => {
    e.preventDefault();
    const newTask = {
      title: document.getElementById('title').value.trim(),
      details: document.getElementById('details').value.trim(),
      priority: document.getElementById('priority').value,
      status: document.getElementById('status').value,
      deadline: parseDateInput(document.getElementById('deadline').value),
      deadlineTime: document.getElementById('deadlineTime').value,
      _addedAt: editIndex === null ? Date.now() : tasks[editIndex]._addedAt
    };

    if(!newTask.title) {
      alert('Titlul este obligatoriu!');
      return;
    }

    if(editIndex !== null) {
      tasks[editIndex] = newTask;
    } else {
      tasks.push(newTask);
    }
    saveTasks();
    renderTasks();
    clearForm();
  });

  personalListBtn.onclick = () => {
    if(currentList === 'personal') return;
    switchList('personal');
  };

  workListBtn.onclick = () => {
    if(currentList === 'work') return;
    switchList('work');
  };

  sortSelect.onchange = () => {
    renderTasks();
  };

  function switchList(newList) {
    currentList = newList;
    tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS[currentList])) || [];
    // actualizeazÄƒ butoane active
    personalListBtn.classList.toggle('active', currentList === 'personal');
    personalListBtn.setAttribute('aria-pressed', currentList === 'personal');
    workListBtn.classList.toggle('active', currentList === 'work');
    workListBtn.setAttribute('aria-pressed', currentList === 'work');
    clearForm();
    renderTasks();
  }

  // Initialize afiÈ™are la pornire
  switchList(currentList);
</script>
</body>
</html>
