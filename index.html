<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AAP - Agenda Afacerilor Personale</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Roboto&display=swap" rel="stylesheet" />
<style>
  :root {
    --bg: #f9f9f9;
    --text: #1a1a1a;
    --card: #ffffff;
    --accent: #f9f9f9;
    --red: #dc3545;
  }
  body.dark {
    --bg: #121212;
    --text: #e0e0e0;
    --card: #1e1e1e;
    --accent: #0e0e0e;
    --red: #ff6b6b;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Roboto', 'Montserrat', sans-serif;
    margin: 0;
    padding: 1rem;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    max-width: 600px;
    margin: auto;
  }
  h1 {
    text-align: center;
    font-size: 3.2rem;
    margin-bottom: 0.3rem;
    font-family: 'Montserrat', sans-serif;
  }
  .submotto {
    text-align: center;
    font-size: 1.1rem;
    color: var(--text);
    margin-bottom: 1rem;
    font-family: 'Roboto', sans-serif;
  }
  .toggle-dark {
    float: right;
    margin-bottom: 1rem;
    cursor: pointer;
    background: none;
    color: var(--accent);
    border: none;
    padding: 0.4rem 0.8rem;
    font-size: 1.2rem;
  }
  form {
    background: var(--card);
    padding: 1.2rem;
    border-radius: 12px;
    display: grid;
    gap: 0.8rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    position: relative;
  }
  input, select, button, textarea {
    padding: 0.6rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: var(--card);
    color: var(--text);
    transition: all 0.2s;
    font-family: 'Roboto', sans-serif;
  }
  button {
    background: var(--accent);
    color: var(--text);
    border: none;
    cursor: pointer;
    font-weight: bold;
    font-family: 'Montserrat', sans-serif;
  }
  body.dark input,
  body.dark select,
  body.dark textarea {
    background: #2a2a2a;
    color: #e0e0e0;
    border: 1px solid #555;
  }
  .calendar-time-container {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }
  .calendar-time-container input[type="date"] {
    flex: 2;
  }
  .calendar-time-container input[type="time"] {
    flex: 1;
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 1.5rem;
  }
  .task {
    background: var(--card);
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  .task-info {
    flex: 1 1 60%;
  }
  .task-actions {
    flex: 1 1 35%;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }
  .task p {
    margin: 0.2rem 0;
  }
  .badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    font-size: 0.8rem;
    border-radius: 5px;
    color: white;
    margin-right: 0.5rem;
    user-select: none;
  }
  .urgent { background: #dc3545; }
  .normal { background: #28a745; }
  .status-in { background: #ffc107; color: black; }
  .status-out { background: #17a2b8; }
  .overdue {
    color: var(--red);
    font-weight: 600;
  }
  .tag {
    display: inline-block;
    padding: 0.1rem 0.5rem;
    border-radius: 4px;
    margin-right: 0.3rem;
    font-size: 0.75rem;
    color: #fff;
    user-select: none;
    font-family: 'Roboto', sans-serif;
  }
  .tag-edit-btn {
    margin-left: 5px;
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 0.85rem;
  }
  .tag-input {
    width: 120px;
  }
  .tags-container {
    margin-top: 0.3rem;
  }
  .icon {
    display: inline-block;
    width: 16px;
    height: 16px;
    vertical-align: middle;
    margin-right: 5px;
  }
  /* Icone simple inline SVG ca background */
  .icon-edit {
    background: url('data:image/svg+xml;utf8,<svg fill="%23000" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM21.41 6.34a1.25 1.25 0 0 0 0-1.77L19.43 2.6a1.25 1.25 0 0 0-1.77 0L15.13 5.14l3.75 3.75 2.53-2.55z"/></svg>') no-repeat center center;
    background-size: contain;
  }
  .icon-delete {
    background: url('data:image/svg+xml;utf8,<svg fill="%23dc3545" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M16 9v10H8V9h8m-1.5-6H9.5l-1 1H5v2h14V4h-3.5l-1-1z"/></svg>') no-repeat center center;
    background-size: contain;
  }
  /* Responsive */
  @media (max-width: 500px) {
    .task {
      flex-direction: column;
    }
    .task-actions {
      justify-content: flex-end !important;
      margin-top: 0.5rem;
    }
    .calendar-time-container {
      flex-direction: column;
    }
    .calendar-time-container input[type="date"], 
    .calendar-time-container input[type="time"] {
      flex: unset;
      width: 100%;
    }
    .toggle-dark {
      float: none;
      display: block;
      margin: 0 auto 1rem auto;
    }
  }
  .floater {
    position: relative;
    margin-bottom: 80px;
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.85rem;
    font-family: 'Roboto', sans-serif;
    color: var(--text);
    user-select: none;
    opacity: 0.7;
  }
  .submitsave {
    color: var(--text);
  }
  .switch-container {
    display: flex;
    justify-content: center;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .switch-container button {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    padding: 0.4rem 1rem;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: var(--card);
    color: var(--text);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: background-color 0.2s, color 0.2s;
  }
  .switch-container button.active {
    background: var(--accent);
    color: var(--text);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  }
  .sort-container {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
    margin-bottom: 1rem;
    gap: 1rem;
  }
  .sort-container select {
    padding: 0.3rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-family: 'Roboto', sans-serif;
    font-size: 1rem;
  }
  /* Tag color picker popup */
  #tagColorPicker {
    position: absolute;
    display: none;
    z-index: 1500;
    padding: 5px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
  }
  #tagColorPicker input[type=color] {
    width: 50px;
    height: 30px;
    border: none;
    cursor: pointer;
    padding: 0;
    background: none;
  }
</style>
</head>
<body>
<div class="container">
  <button class="toggle-dark" id="darkToggle" aria-label="Toggle dark mode">ðŸŒ“</button>
  <h1>AAP</h1>
  <p class="submotto">Agenda Afacerilor Personale</p>

  <div class="switch-container" role="radiogroup" aria-label="Alege lista">
    <button id="personalListBtn" class="active" aria-pressed="true" type="button">Afaceri Interne</button>
    <button id="workListBtn" aria-pressed="false" type="button">Afaceri Externe</button>
    <button id="operationalListBtn" aria-pressed="false" type="button">Afaceri OperaÈ›ionale</button>
  </div>

  <div class="sort-container">
    <label for="sortSelect">Sortare:</label>
    <select id="sortSelect" aria-label="SelecteazÄƒ criteriul de sortare">
      <option value="added">Data adÄƒugÄƒrii</option>
      <option value="deadline">Deadline</option>
      <option value="priority">Prioritate</option>
    </select>
  </div>

  <form id="taskForm" autocomplete="off" aria-label="Formular adÄƒugare/modificare task">
    <input type="text" id="title" placeholder="Ce ai de fÄƒcut?" required aria-required="true" aria-label="Titlu task" />
    <textarea id="details" rows="2" placeholder="Detalii (opÈ›ional)" aria-label="Detalii task"></textarea>
    <select id="priority" aria-label="Prioritate">
      <option value="normal">Prioritate: Normal</option>
      <option value="urgent">Prioritate: Urgent</option>
    </select>
    <select id="status" aria-label="Status">
      <option value="in">Status: ÃŽn curs</option>
      <option value="out">Status: Gata</option>
    </select>
    <div class="calendar-time-container">
      <input type="date" id="deadline" aria-label="Deadline" />
      <input type="time" id="deadlineTime" aria-label="Ora deadline" />
    </div>
    <div>
      <label for="tagsInput" style="display:block; margin-top: 0.4rem;">Taguri (separate prin virgulÄƒ):</label>
      <input type="text" id="tagsInput" placeholder="ex: important, client, facturÄƒ" aria-label="Taguri task" />
      <small style="font-size: 0.8rem; color: #666;">ApasÄƒ Enter pentru a adÄƒuga tagul</small>
    </div>
    <button type="submit" class="submitsave" aria-label="SalveazÄƒ task">SalveazÄƒ task</button>
  </form>

  <ul id="taskList" aria-live="polite" aria-label="Lista taskurilor"></ul>
</div>

<div id="tagColorPicker" role="dialog" aria-modal="true" aria-label="SelecteazÄƒ culoarea tagului">
  <input type="color" id="colorPicker" aria-label="Selector culoare" />
</div>

<div class="floater">by @mhpetcu</div>

<script>
  // FormateazÄƒ data din yyyy-mm-dd Ã®n dd/mm/yyyy
  const formatDateDisplay = (dateStr) => {
    if (!dateStr) return '';
    const [year, month, day] = dateStr.split('-');
    return `${day}/${month}/${year}`;
  };

  // Dark mode toggle
  const darkToggle = document.getElementById("darkToggle");
  darkToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  });
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  // Liste È™i sortare
  const personalListBtn = document.getElementById('personalListBtn');
  const workListBtn = document.getElementById('workListBtn');
  const operationalListBtn = document.getElementById('operationalListBtn');
  const sortSelect = document.getElementById('sortSelect');
  const taskListElem = document.getElementById('taskList');
  const taskForm = document.getElementById('taskForm');

  // Stocare localStorage pe categorii
  const STORAGE_KEYS = {
    personal: 'tasks_personal',
    work: 'tasks_work',
    operational: 'tasks_operational'
  };

  let currentList = 'personal';
  let tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS[currentList])) || [];
  let editIndex = null;

  // Pentru taguri - map {tagName: color}
  let tagColors = JSON.parse(localStorage.getItem('tagColors')) || {};

  // Elemente tagColorPicker
  const tagColorPicker = document.getElementById('tagColorPicker');
  const colorPicker = document.getElementById('colorPicker');

  // Functie salvare tagColors localStorage
  function saveTagColors() {
    localStorage.setItem('tagColors', JSON.stringify(tagColors));
  }

  // Functie comparare pentru sortare
  function compareTasks(a, b) {
    const criteria = sortSelect.value;
    if (criteria === 'added') {
      return a._addedAt - b._addedAt;
    }
    if (criteria === 'deadline') {
      if (!a.deadline && b.deadline) return 1;
      if (a.deadline && !b.deadline) return -1;
      if (!a.deadline && !b.deadline) return 0;

      if (a.deadline < b.deadline) return -1;
      if (a.deadline > b.deadline) return 1;

      if (!a.deadlineTime && b.deadlineTime) return 1;
      if (a.deadlineTime && !b.deadlineTime) return -1;
      if (!a.deadlineTime && !b.deadlineTime) return 0;

      if (a.deadlineTime < b.deadlineTime) return -1;
      if (a.deadlineTime > b.deadlineTime) return 1;

      return 0;
    }
    if (criteria === 'priority') {
      if (a.priority === b.priority) return 0;
      if (a.priority === 'urgent') return -1;
      if (b.priority === 'urgent') return 1;
    }
    return 0;
  }

  function saveTasks() {
    localStorage.setItem(STORAGE_KEYS[currentList], JSON.stringify(tasks));
  }

  function renderTasks() {
    taskListElem.innerHTML = '';
    tasks.sort(compareTasks);

    if(tasks.length === 0){
      taskListElem.innerHTML = '<li>Lista este goalÄƒ.</li>';
      return;
    }

    const nowDate = new Date();

    tasks.forEach((t, i) => {
      const li = document.createElement('li');
      li.className = 'task';

      const taskInfo = document.createElement('div');
      taskInfo.className = 'task-info';

      // Titlu
      const title = document.createElement('p');
      title.textContent = t.title;
      title.style.fontWeight = '600';

      // Detalii
      const details = document.createElement('p');
      details.textContent = t.details || '';

      // Prioritate badge
      const priorityBadge = document.createElement('span');
      priorityBadge.className = 'badge ' + (t.priority === 'urgent' ? 'urgent' : 'normal');
      priorityBadge.textContent = t.priority === 'urgent' ? 'Urgent' : 'Normal';

      // Status badge
      const statusBadge = document.createElement('span');
      statusBadge.className = 'badge ' + (t.status === 'in' ? 'status-in' : 'status-out');
      statusBadge.textContent = t.status === 'in' ? 'ÃŽn curs' : 'Gata';

      // Deadline text
      let deadlineText = '';
      if (t.deadline) {
        deadlineText = formatDateDisplay(t.deadline);
        if(t.deadlineTime){
          deadlineText += ' ' + t.deadlineTime;
        }
        // VerificÄƒ dacÄƒ deadline-ul e trecut È™i statusul e "in"
        const deadlineDate = new Date(t.deadline + 'T' + (t.deadlineTime || '23:59'));
        if (deadlineDate < nowDate && t.status === 'in') {
          deadlineText = '';
          deadlineText = `[Peste termen] ${deadlineText}`;
          deadlineText = deadlineText.trim();
          // marcare culoare
          deadlineText = `<span class="overdue">${deadlineText}</span>`;
        }
      }

      // Tags container
      const tagsContainer = document.createElement('div');
      tagsContainer.className = 'tags-container';
      if (t.tags && t.tags.length > 0) {
        t.tags.forEach(tag => {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'tag';
          tagSpan.textContent = tag;
          tagSpan.style.backgroundColor = tagColors[tag] || '#6c757d';

          // Buton edit culoare tag
          const editBtn = document.createElement('button');
          editBtn.className = 'tag-edit-btn';
          editBtn.title = 'EditeazÄƒ culoarea tagului';
          editBtn.textContent = 'ðŸŽ¨';
          editBtn.type = 'button';
          editBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            openTagColorPicker(tagSpan, tag);
          });
          tagSpan.appendChild(editBtn);

          tagsContainer.appendChild(tagSpan);
        });
      }

      // Creare element deadline
      const deadlineElem = document.createElement('p');
      deadlineElem.innerHTML = deadlineText;

      // Grup badges È™i deadline
      const badgeWrapper = document.createElement('p');
      badgeWrapper.appendChild(priorityBadge);
      badgeWrapper.appendChild(statusBadge);

      taskInfo.appendChild(title);
      taskInfo.appendChild(details);
      taskInfo.appendChild(badgeWrapper);
      taskInfo.appendChild(deadlineElem);
      taskInfo.appendChild(tagsContainer);

      const taskActions = document.createElement('div');
      taskActions.className = 'task-actions';

      const editBtn = document.createElement('button');
      editBtn.setAttribute('aria-label', 'EditeazÄƒ task');
      editBtn.className = 'icon icon-edit';
      editBtn.type = 'button';
      editBtn.addEventListener('click', () => editTask(i));

      const deleteBtn = document.createElement('button');
      deleteBtn.setAttribute('aria-label', 'È˜terge task');
      deleteBtn.className = 'icon icon-delete';
      deleteBtn.type = 'button';
      deleteBtn.addEventListener('click', () => deleteTask(i));

      taskActions.appendChild(editBtn);
      taskActions.appendChild(deleteBtn);

      li.appendChild(taskInfo);
      li.appendChild(taskActions);

      taskListElem.appendChild(li);
    });
  }

  function resetForm() {
    taskForm.reset();
    editIndex = null;
    taskForm.querySelector('button[type=submit]').textContent = 'SalveazÄƒ task';
  }

  function addOrUpdateTask(e) {
    e.preventDefault();

    const title = document.getElementById('title').value.trim();
    const details = document.getElementById('details').value.trim();
    const priority = document.getElementById('priority').value;
    const status = document.getElementById('status').value;
    const deadline = document.getElementById('deadline').value; // yyyy-mm-dd ISO
    const deadlineTime = document.getElementById('deadlineTime').value; // HH:mm
    const tagsRaw = document.getElementById('tagsInput').value.trim();

    if (!title) return alert('Titlul este obligatoriu.');

    const tags = tagsRaw.length > 0
      ? tagsRaw.split(',').map(t => t.trim()).filter(t => t.length > 0)
      : [];

    if(editIndex === null) {
      tasks.push({
        title,
        details,
        priority,
        status,
        deadline,
        deadlineTime,
        tags,
        _addedAt: Date.now(),
      });
    } else {
      tasks[editIndex] = {
        ...tasks[editIndex],
        title,
        details,
        priority,
        status,
        deadline,
        deadlineTime,
        tags,
      };
    }
    saveTasks();
    renderTasks();
    resetForm();
  }

  function editTask(i) {
    const t = tasks[i];
    editIndex = i;
    document.getElementById('title').value = t.title;
    document.getElementById('details').value = t.details || '';
    document.getElementById('priority').value = t.priority || 'normal';
    document.getElementById('status').value = t.status || 'in';
    document.getElementById('deadline').value = t.deadline || '';
    document.getElementById('deadlineTime').value = t.deadlineTime || '';
    document.getElementById('tagsInput').value = (t.tags || []).join(', ');
    taskForm.querySelector('button[type=submit]').textContent = 'ModificÄƒ task';
  }

  function deleteTask(i) {
    if (confirm('È˜tergi acest task?')) {
      tasks.splice(i, 1);
      saveTasks();
      renderTasks();
      resetForm();
    }
  }

  // Comutare Ã®ntre liste
  function switchList(listName) {
    if (listName === currentList) return;

    // Butoane aria-pressed È™i clasa active
    [personalListBtn, workListBtn, operationalListBtn].forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-pressed', 'false');
    });
    if(listName === 'personal') {
      personalListBtn.classList.add('active');
      personalListBtn.setAttribute('aria-pressed', 'true');
    } else if(listName === 'work') {
      workListBtn.classList.add('active');
      workListBtn.setAttribute('aria-pressed', 'true');
    } else if(listName === 'operational') {
      operationalListBtn.classList.add('active');
      operationalListBtn.setAttribute('aria-pressed', 'true');
    }

    saveTasks();
    currentList = listName;
    tasks = JSON.parse(localStorage.getItem(STORAGE_KEYS[currentList])) || [];
    resetForm();
    renderTasks();
  }

  personalListBtn.addEventListener('click', () => switchList('personal'));
  workListBtn.addEventListener('click', () => switchList('work'));
  operationalListBtn.addEventListener('click', () => switchList('operational'));
  sortSelect.addEventListener('change', renderTasks);
  taskForm.addEventListener('submit', addOrUpdateTask);

  // --- Tag Color Picker ---
  let currentTagSpan = null;
  let currentTagName = null;

  function openTagColorPicker(tagSpan, tagName) {
    currentTagSpan = tagSpan;
    currentTagName = tagName;

    // Pozitionare tagColorPicker
    const rect = tagSpan.getBoundingClientRect();
    tagColorPicker.style.top = (rect.bottom + window.scrollY + 5) + 'px';
    tagColorPicker.style.left = (rect.left + window.scrollX) + 'px';
    tagColorPicker.style.display = 'block';

    // Seteaza culoarea curenta
    colorPicker.value = tagColors[tagName] || '#6c757d';

    colorPicker.focus();
  }

  colorPicker.addEventListener('input', () => {
    if (currentTagName && currentTagSpan) {
      tagColors[currentTagName] = colorPicker.value;
      currentTagSpan.style.backgroundColor = colorPicker.value;
      saveTagColors();
    }
  });

  // ÃŽnchidere color picker cÃ¢nd click Ã®n afara
  document.addEventListener('click', (e) => {
    if (!tagColorPicker.contains(e.target) && !e.target.classList.contains('tag-edit-btn')) {
      tagColorPicker.style.display = 'none';
      currentTagSpan = null;
      currentTagName = null;
    }
  });

  // IniÈ›ializare
  renderTasks();

</script>
</body>
</html>
